<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/EcoUnity/static/prueba.css">
  <title>PRODUCTOS</title>
</head>

<body>
  <header>
    <a href="#" class="logo"><i class='bx bx-basket'></i>Ecounity</a>
    <!--  Menu icon -->
    <!-- crear una clase .bx.bx-menu#menu-icon -->
    <div class="bx bx-menu" id="menu-icon"></div>

    <!-- Nav List -->
    <ul class="navbar">
      <li><a href="./inicio.html" class="home-active">Inicio</a></li>
      <li><a href="#categorias">Categorias</a></li>
      <li><a href="./prueba.html">Productos</a></li>
      <li><a href="#map">Puntos reciclaje</a></li>
      <li><a href="#map">Puntos reforestacion</a></li>
      <li><a href="#information">Informacion</a></li>
    </ul>
    <!-- Profile  -->
    <div class="profile">
      <img
        src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAAAmFJREFUSEvl1knIjVEcx/HPS+aNcWVnYSND5lKmiNgQC2RFyZBMCymlWFjItEBSNkRKSUJIFBtTkSHWZCEkRZHp+b+dt+77vPfe57n3vvUunN29zzm/7/kP53dOmx4abT3E1Qy4N8ZhStr0QzzH70aCaBS8DEcxMgd5i824XBbeCPgwthYIH8KOMvCy4Pm4mQQfYReepN+TsL8i9XNxpwheFnwL81ItJ+NnTrgvHmMsrmNRd4B74Rv6YxOO1xDdiGP4mvXBEPypBy8TcXTwsySyGNdqCEaUV9O3MXjVKjg6+F0SWYXzNQRX4lz6FmvetwqO9Z8wFPW69mCW5u34mKV8RHfUODT2YXcyiaW4khNegovZvDCXPdjbXeBorJcYlQTvpy7ukzp5Zvr/TXK1fNd32UeZ5upYFE12NoGqBRS2GXWODRaORsAhFkdrAxZgepb+XynyOLsni45Q5W4aBRdGUnZCWfAwzMhcaRrCufrlAD9S5A8yh4v6fy7aQBF4MA5gLaWv0L8p7TuTi1XdQz3wcpzA8IqV35OLVfPq8RhYMfcD1uNSNXItcFzykbaO76dxBC+ycxoR1dKKS2IL1qQJMXdqKkOnNdXAcdPE0RiNiHAh7hXVLPd9VvL0yMDrLOrIRqcsVQOHLW5LQuuy18apBqEd0yPNUaoYXay2GjiiHIAbKdomue3LbiMeBqE5qN45jmMTJh9jBS60QsVqnEkacUd/6dDLRzyx4kkTtY2oWxmVd3RYbvRO+8iDZ1e8l+bgbivUbH1NvTw4DGNCgj2tTE2TG6ipV+RcTfKKl/1/4H9Qfmkf+jdIxwAAAABJRU5ErkJggg==" />
      <span><a href="./login.html">Acceder</a></span>
      <i class="bx bx-caret-down"></i>
    </div>
  </header>

  <div class="container-principal">
    <!-- Formulario de búsqueda por ID -->
    <form id="searchForm">
      <div class="mb-3">
        <input type="number" class="form-control" id="productId" placeholder="Buscar productos por ID">
        <button type="submit" class="btn btn-primary">Buscar</button>
      </div>
    </form>
    <br>
    <div class="row" id="data"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script>
    const searchForm = document.getElementById('searchForm');
    const dataContainer = document.getElementById('data');
    let allProducts = [];

    // Función para cargar todos los productos
    const loadAllProducts = async () => {
      try {
        const response = await fetch('http://localhost:3000/api/v1/products');
        if (!response.ok) {
          throw new Error('Failed to fetch products');
        }
        allProducts = await response.json();
        updateTable(allProducts);
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to fetch products');
      }
    };

    // Función para actualizar la tabla con los productos
    const updateTable = (products) => {
      let body = '';
      for (const product of products) {
        body += `
          <div class="container-cards">
            <div class="product-card">
              <img src="${product.image}" alt="${product.name}">
              <h5>${product.name}</h5>
              <p>Price: $${product.price}</p>
              <p>${product.description}</p>
            </div>
          </div>
        `;
      }
      dataContainer.innerHTML = body;
    };

    // Función para buscar un producto por ID
    const searchProductById = (productId) => {
      if (productId !== '') {
        const product = allProducts.find(product => product.id === parseInt(productId));
        if (product) {
          updateTable([product]);
        } else {
          dataContainer.innerHTML = '<div class="col-md-12 text-center">NO HEMOS ENCONTRADO EL PRODUCTO BUSCADO</div>';
        }
      } else {
        loadAllProducts();
      }
    };

    // Evento de submit del formulario de búsqueda
    searchForm.addEventListener('submit', async (event) => {
      event.preventDefault();
      const productId = document.getElementById('productId').value;
      searchProductById(productId);
    });

    // Cargar todos los productos al cargar la página
    loadAllProducts();
  </script>
</body>

</html>